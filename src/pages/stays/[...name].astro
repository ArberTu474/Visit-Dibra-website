---
// Layout
import Layout from '../../layouts/Layout.astro'

// Components
import Card from '../../components/ui/general/Card.astro'
import { Icon } from 'astro-iconify'
import Stars from '../../components/ui/general/Stars.astro'

export async function getStaticPaths() {
  // Get the hotel rooms
  const response = await fetch(
    'https://anfqbgopkaezhvbymkhu.supabase.co/rest/v1/hotels?name',
    {
      headers: {
        apikey: `${import.meta.env.PUBLIC_APIKEY}`,
        Authorization: `${import.meta.env.PUBLIC_AUTHORIZATION}`,
      },
    }
  )
  const rooms = await response.json()

  return rooms.map(
    ({
      id,
      created_at,
      name,
      description,
      rating,
      location,
      location_url,
      phone,
      email,
      rooms,
      rules_allowed,
      rules_not_allowed,
      images,
      facilities,
    }) => {
      return {
        params: { name },
        props: {
          id,
          created_at,
          name,
          description,
          rating,
          location,
          location_url,
          phone,
          email,
          rooms,
          rules_allowed,
          rules_not_allowed,
          images,
          facilities,
        },
      }
    }
  )
}

const {
  id,
  created_at,
  name,
  description,
  rating,
  location,
  location_url,
  phone,
  email,
  rooms,
  rules_allowed,
  rules_not_allowed,
  images,
  facilities,
} = Astro.props
---

<Layout title={name}>
  <div class='page-container mt-6'>
    <section class='flex flex-col gap-6 items-center'>
      <section class='flex flex-col md:flex-row w-full items-center md:gap-6'>
        <div
          class='bg-gray-300/30 hover:bg-gray-300/60 border border-gray-400/20 rounded-none rounded-t-lg md:rounded-lg w-full text-center hover:opacity-80 cursor-pointer text-lg py-3 font-bold text-gray-600'
        >
          <a href='#'>Rooms & Prices</a>
        </div>
        <div
          class='bg-gray-300/30 hover:bg-gray-300/60 border border-gray-400/20 rounded-none md:rounded-lg w-full text-center hover:opacity-80 cursor-pointer text-lg py-3 font-bold text-gray-600'
        >
          <a href='#'>Facilities</a>
        </div>
        <div
          class='bg-gray-300/30 hover:bg-gray-300/60 border border-gray-400/20 rounded-none rounded-b-lg md:rounded-lg w-full text-center hover:opacity-80 cursor-pointer text-lg py-3 font-bold text-gray-600'
        >
          <a href='#'>Rules</a>
        </div>
      </section>

      <!-- Image gallery section -->

      <div class='w-full h-96 md:h-[620px] rounded-lg bg-gray-300'></div>

      <!-- Hotel Info section -->
      <div class='flex flex-col gap-6'>
        <div
          class='flex flex-col md:flex-row items-start justify-between md:items-center gap-6 md:gap-1 w-full'
        >
          <div>
            <Stars rating={rating} />
            <h1 class='text-3xl font-bold my-1'>{name}</h1>
            <a
              href={location_url}
              target='_blank'
              class='flex gap-1 items-center hover:underline'
            >
              <Icon
                name='material-symbols:location-on-rounded'
                class='text-gray-600 h-6 w-6'
              />
              <p class='text-sm text-gray-600'>{location}</p>
            </a>
          </div>
          <div
            class='flex w-full md:w-min flex-col md:flex-row items-end justify-between gap-3 md:gap-6'
          >
            <div class='hidden md:flex gap-1'>
              <a
                class='hover:bg-indigo-200/40 p-2 rounded-full transition-colors duration-200 ease-in-out'
                href=`tel:${phone}`
                title='Phone'
              >
                <Icon
                  name='material-symbols:call-outline'
                  class='text-indigo-900 h-8'
                />
              </a>
              <a
                class='hover:bg-indigo-200/40 p-2 rounded-full transition-colors duration-200 ease-in-out'
                href=`mailto:${email}`
                title='Email'
              >
                <Icon
                  name='material-symbols:mail-outline'
                  class='text-indigo-900 h-8'
                />
              </a>
              <a
                class='hover:bg-indigo-200/40 p-2 rounded-full transition-colors duration-200 ease-in-out'
                title='Share'
                href=`mailto:${email}`
              >
                <Icon
                  name='material-symbols:share-outline'
                  class='text-indigo-900 h-8'
                />
              </a>
            </div>
            <a
              class='flex w-full md:w-min justify-center gap-3 items-center text-base text-gray-100 bg-indigo-900 rounded-lg py-3 px-4 font-bold hover:opacity-90 transition-opacity duration-200 ease-in-out'
              href=''
            >
              <Icon
                name='material-symbols:sell'
                class='text-gray-100 h-6 w-6'
              />
              Reserve
            </a>

            <!-- Mobile contact and share buttons -->
            <div class='flex w-full gap-3 md:hidden'>
              <a
                class='w-full flex justify-center bg-indigo-200/40 hover:bg-indigo-200/70 p-2 rounded-lg transition-colors duration-200 ease-in-out'
                href=`tel:${phone}`
                title='Phone'
              >
                <Icon
                  name='material-symbols:call-outline'
                  class='text-indigo-900 h-8'
                />
              </a>
              <a
                class='w-full flex justify-center bg-indigo-200/40 hover:bg-indigo-200/70 p-2 rounded-lg transition-colors duration-200 ease-in-out'
                href=`mailto:${email}`
                title='Email'
              >
                <Icon
                  name='material-symbols:mail-outline'
                  class='text-indigo-900 h-8'
                />
              </a>
              <button
                id='share'
                class='w-full flex justify-center bg-indigo-200/40 hover:bg-indigo-200/70 p-2 rounded-lg transition-colors duration-200 ease-in-out'
                title='Share'
              >
                <Icon
                  name='material-symbols:share-outline'
                  class='text-indigo-900 h-8'
                />
              </button>
            </div>
          </div>
        </div>
        <div class='grid grid-cols1 md:grid-cols-3 gap-6'>
          <div>
            <h2 class='font-bold mb-1 text-lg'>About the hotel:</h2>
            <p class='col-span-2 text-gray-600'>{description}</p>
          </div>
          <p>Facilities</p>
        </div>
      </div>
    </section>
  </div>
</Layout>
<script type='text\javascript'>
const shareBtn = document.querySelector('#share')

const shareData = {
  title: 'MDN',
  text: 'Learn web development on MDN!',
  url: 'http://localhost:3000/stays/Korabi%20Hotel',
}

if (shareBtn) {
  shareBtn.addEventListener('click', () => {
    if (navigator.share) {
      navigator
        .share({
          title: document.title,
          text: document.title,
          url: window.location.href,
        })
        .then(() => console.log('Share'))
        .catch((e) => console.log(e))
    }
  })
}
</script>
